[toc]

## å®ä¹ ä»»åŠ¡

1. é€‰æ‹©ä¸€ç§å…¬å…±åœ°å›¾èµ„æºï¼ŒåŠ è½½åœ°å›¾æœåŠ¡ã€‚

2. è®¾è®¡åœ°å›¾æ§ä»¶ï¼ˆè‡³å°‘3ç§ï¼‰ã€‚

3. ä»¥å®ä¹ ä¸€ç½‘é¡µä¸ºåŸºç¡€ï¼Œè¯•ç€ç»¼åˆè¿ç”¨`Openlayers`ä¸­çš„åŠ¨ç”»æ•ˆæœï¼ˆåå¼¹ã€æ—‹è½¬ã€è‡ªæ—‹ã€é£è¡Œã€èºæ—‹ç­‰ï¼‰ï¼Œå®ç°è‡ªå·±çš„å°å­¦>åˆä¸­>é«˜ä¸­>å¤§å­¦å››ä¸ªåœ°ç‚¹çš„åŠ¨ç”»è·³è½¬å®šä½ã€‚

##  ç¬¬ä¸‰æ–¹åº“ä½¿ç”¨

###  OpenLayers

â€‹     	`openlayers `æ˜¯ä¸€ç§ç”¨äº Web åœ°å›¾å¼€å‘çš„ JavaScript åº“ã€‚å®ƒæä¾›äº†ä¸€ç»„ä¸°å¯Œçš„ `API`ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿåœ¨ç½‘é¡µä¸­æ·»åŠ åœ°å›¾ã€å›¾å±‚å’Œäº¤äº’å…ƒç´ ï¼Œä»¥åŠä¸åœ°å›¾è¿›è¡Œäº¤äº’ã€‚

`openlayers `æ”¯æŒä¼—å¤šçš„åœ°å›¾æ•°æ®æºå’Œæ ¼å¼ï¼ŒåŒ…æ‹¬ `Google Maps`ã€`Bing Maps`ã€`OpenStreetMap`ã€`WMS`ã€`WFS`ã€`KML`ã€`GeoJSON `ç­‰ã€‚å®ƒè¿˜æ”¯æŒå¤šç§æŠ•å½±æ–¹å¼ï¼Œå¦‚ `Web Mercator`ã€`EPSG:4326`ã€`EPSG:3857` ç­‰ã€‚

â€‹      	é€šè¿‡ `openlayers`ï¼Œå¼€å‘è€…å¯ä»¥è½»æ¾åœ°å®ç°åœ°å›¾çš„å¯è§†åŒ–ã€æœç´¢ã€æ ‡æ³¨ã€ç¼©æ”¾ã€å¹³ç§»ã€æ—‹è½¬ã€æµ‹é‡ç­‰åŠŸèƒ½ã€‚åŒæ—¶ï¼Œ`openlayers `è¿˜æ”¯æŒè‡ªå®šä¹‰å›¾å±‚å’Œæ§ä»¶ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œå®šåˆ¶åŒ–å¼€å‘ã€‚

â€‹		æ€»ä¹‹ï¼Œ`openlayers `æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€æ˜“ç”¨æ€§é«˜çš„ Web åœ°å›¾å¼€å‘åº“ï¼Œé€‚ç”¨äºå„ç§ç±»å‹çš„åœ°å›¾åº”ç”¨ç¨‹åºã€‚

â€‹		å®˜æ–¹ç½‘å€ï¼š[OpenLayers - Welcome](https://openlayers.org)

###  MapBox JS

` Mapbox GL JS` æ˜¯ä»–ä»¬çš„ä¸€ä¸ªå¼€æºå®¢æˆ·ç«¯åº“ï¼Œç”¨äºæ¸²æŸ“ Web ç«¯çš„å¯äº¤äº’åœ°å›¾ã€‚ä½œä¸º `Mapbox `ç”Ÿæ€ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒé€šå¸¸ä¸ `Mapbox `æä¾›çš„å…¶ä»–æœåŠ¡é›†æˆåœ¨ä¸€èµ·ï¼Œç»Ÿä¸€å¯¹å¤–ä½¿ç”¨ã€‚ç›®å‰ `Mapbox `å…¬å¸çš„ä¸»è¥ä¸šåŠ¡é™¤äº†åœ°å›¾ç›¸å…³äº§å“ï¼Œè¿˜åŒ…æ‹¬ LBS(Location Based Services)æœåŠ¡ã€è‡ªåŠ¨é©¾é©¶ã€è‡ªæœ‰æ•°æ®(Boundaries, Traffic Data, Movement)ä»¥åŠè½¦æœºæœåŠ¡ã€‚`Mapbox GL JS` æ˜¯ä¸€ä¸ª JavaScript åº“ï¼Œå®ƒä½¿ç”¨ `WebGL `æŠ€æœ¯ï¼Œä»¥vector tilesæ–¹å¼æ•°æ®ç»„ç»‡ï¼Œä»¥`Mapbox styles`æ¥é…ç½®åœ°å›¾æ ·å¼è§„åˆ™ï¼Œæœ€ç»ˆæ¸²æŸ“å¾—åˆ°äº¤äº’å¼åœ°å›¾ã€‚`Mapbox GL` ç”Ÿæ€ç³»ç»Ÿçš„å¦ä¸€éƒ¨åˆ†æ˜¯`Mapbox Mobile`ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨ C++ ç¼–å†™çš„å…¼å®¹æ¡Œé¢å’Œç§»åŠ¨å¹³å°çš„æ¸²æŸ“å¼•æ“ã€‚

â€‹		å®˜æ–¹ç½‘å€ï¼š[Mapbox GL JS | Mapbox](https://docs.mapbox.com/mapbox-gl-js/guides/)

###  ArcGIS API for JavaScript



###  Cesium

####  Cesiumç®€ä»‹

â€‹		`Cesium `æ˜¯ä¸€ä¸ªå¼€æºçš„ `JavaScript `åº“ï¼Œç”¨äºåˆ›å»ºé«˜æ€§èƒ½çš„ `3D `åœ°çƒå’Œåœ°ç†ç©ºé—´åº”ç”¨ç¨‹åºã€‚ å®ƒå¯ä»¥åœ¨ä»»ä½•ç°ä»£çš„ `Web `æµè§ˆå™¨ä¸­è¿è¡Œï¼Œå¹¶ä¸”æ”¯æŒå¤šç§æ•°æ®æºå’Œæ ¼å¼ï¼ŒåŒ…æ‹¬ `3D `æ¨¡å‹ã€å½±åƒã€ çŸ¢é‡æ•°æ®ã€åœ°å½¢å’Œå®æ—¶æ•°æ®æµã€‚`Cesium `åŸºäº `WebGL `æ¥æ¸²æŸ“ `3D `å›¾å½¢ï¼Œå¹¶ä¸”å…·æœ‰é«˜åº¦ä¼˜åŒ–çš„ æ¸²æŸ“å¼•æ“ï¼Œä½¿å¾—å¤§è§„æ¨¡çš„ `3D `æ•°æ®å¯è§†åŒ–æˆä¸ºå¯èƒ½ã€‚`Cesium `æä¾›äº†ä¸€å¥—ä¸°å¯Œçš„ `API `å’Œå·¥å…·ï¼Œ ä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥è½»æ¾åœ°åˆ›å»ºå…·æœ‰é«˜çº§åœ°ç†ç©ºé—´åŠŸèƒ½çš„åº”ç”¨ç¨‹åºã€‚å®ƒæ”¯æŒå¤šç§åœ°å›¾æŠ•å½±å’Œå æ ‡ç³»ï¼Œå¹¶ä¸”å…·æœ‰å¼ºå¤§çš„åœ°ç†ç©ºé—´åˆ†æå’Œå¯è§†åŒ–åŠŸèƒ½ï¼ŒåŒ…æ‹¬è·¯å¾„åˆ†æã€å¯è§†åŸŸåˆ†æã€`3D `æµ‹é‡ å’Œåœ°å½¢åˆ†æç­‰ã€‚`Cesium `è¿˜å…·æœ‰å¼€æ”¾çš„æ’ä»¶æ¶æ„ï¼Œä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥è½»æ¾åœ°æ‰©å±•å…¶åŠŸèƒ½ï¼Œå¹¶ é›†æˆå…¶ä»–ç¬¬ä¸‰æ–¹å·¥å…·å’Œæ•°æ®æºã€‚å¦å¤–ï¼Œ`Cesium `è¿˜æä¾›äº†ä¸€äº›åŸºäºäº‘çš„æœåŠ¡ï¼Œå¦‚ `Cesium ion`ï¼Œ å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿåˆ›å»ºã€æ‰˜ç®¡å’Œåˆ†äº«åœ°ç†ç©ºé—´æ•°æ®å’Œåº”ç”¨ç¨‹åºã€‚

####  Cesium çš„æ•°æ®ç±»å‹

â€‹		åœ¨ `Cesium `ä¸­ï¼Œåœ°ç†æ•°æ®ç®¡ç†æ–¹å¼ä¸ `Openlayers` çš„è¦ç´ ï¼ˆ`Feature`ï¼‰ã€æ•°æ®æºï¼ˆ`Source`ï¼‰å’Œ å›¾å±‚ï¼ˆ`Layers`ï¼‰æ¨¡å¼ä¸åŒï¼Œ`Cesium `çš„è¦ç´ ä¸»è¦ç”±å®ä½“ï¼ˆ`Entity`ï¼‰æ„æˆï¼Œè€Œå®ä½“åˆç”±å›¾å…ƒï¼ˆ`Primitive`ï¼‰ ç»„æˆã€‚`Primitive `æ˜¯ `Cesium `ä¸­æœ€åŸºæœ¬çš„ `3D `å‡ ä½•å½¢çŠ¶ï¼Œå¦‚ç‚¹ã€çº¿ã€å¤šè¾¹å½¢ã€æ¨¡å‹ç­‰ã€‚å®ƒä»¬å¯ ä»¥åŒ…å«å‡ ä½•ä¿¡æ¯å’Œæè´¨ä¿¡æ¯ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ä¼ é€’ä¸åŒçš„å‡ ä½•å’Œæè´¨å±æ€§æ¥æ¸²æŸ“ä¸åŒçš„ `3D `å¯¹ è±¡ã€‚`Cesium `æä¾›äº†è®¸å¤šä¸åŒç±»å‹çš„å›¾å…ƒï¼ŒåŒ…æ‹¬ `Primitive`ã€`GroundPrimitive`ã€`Model`ã€`Billboard `ç­‰ï¼Œå¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„å›¾å…ƒç±»å‹ã€‚Entity æ˜¯ä¸€ç§æ›´é«˜çº§åˆ«çš„å¯¹è±¡ï¼Œå®ƒå¯ä»¥å…·æœ‰å„ç§å± æ€§å’Œè¡Œä¸ºï¼Œå¦‚ä½ç½®ã€å§¿æ€ã€è¿åŠ¨ã€æ ‡è®°ã€äº‹ä»¶ç­‰ã€‚å®ä½“é€šå¸¸æ˜¯ç”±å›¾å…ƒç»„æˆçš„ï¼Œä½†å®ƒä»¬è¿˜å¯ä»¥ åŒ…å«å…¶ä»–é™„åŠ ä¿¡æ¯å’Œæ“ä½œã€‚ä¾‹å¦‚ï¼Œå®ä½“å¯ä»¥ç”¨äºè¡¨ç¤ºé£æœºã€æ±½è½¦ã€äººã€å»ºç­‘ç‰©ç­‰ç‰©ä½“ï¼Œæˆ–è€… ç”¨äºè¡¨ç¤ºä¼ æ„Ÿå™¨ã€æ‘„åƒå¤´ã€é›·è¾¾ç­‰è®¾å¤‡ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œ`Entity `å’Œ `Primitive `é»˜è®¤ç»‘å®šåœ¨ä¸€ä¸ªå¯¹ è±¡ä¸Šï¼Œä¹Ÿå¯ä»¥å•ç‹¬åˆ›å»º `Primitive `æ˜¾ç¤ºï¼Œè€Œä¸åˆ›å»ºå¯¹åº”çš„ `Entity`ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡ `Entity `çš„æ¥å£ é«˜æ•ˆä¾¿æ·è®¾ç½®è¦ç´ çš„å±æ€§ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ `Primitive `ç²¾ç»†æ§åˆ¶å¯¹è±¡çš„æ¯ä¸ªéƒ¨åˆ†ï¼Œç”šè‡³è‡ªå·±ç¼–å†™ `GLSL `æ¥æ§åˆ¶ç€è‰²å™¨ã€‚ é™¤äº† `Primitive `å’Œ `Entity`ï¼Œ`Cesium` è¿˜åŒ…æ‹¬åŠ è½½ä¸åŒæ•°æ®ç±»å‹çš„é‡è¦ç±»ä¸æ¥å£ï¼Œåˆ†åˆ«ä¸ºï¼š

ï¼ˆ1ï¼‰`DataSource`

 `DataSource `æ˜¯ä¸€ç§è¡¨ç¤ºåœ°ç†ç©ºé—´æ•°æ®çš„æ¦‚å¿µï¼Œå®ƒå¯ä»¥åŒ…å«å¤šä¸ªå®ä½“å’Œå±æ€§ã€‚æ•°æ®æºå¯ä»¥ ä»æ–‡ä»¶ã€æœåŠ¡ã€æ•°æ®åº“ç­‰ä¸åŒæ¥æºä¸­åŠ è½½æ•°æ®ï¼Œå¹¶ä½¿ç”¨ `Cesium API` è¿›è¡Œæ“ä½œå’Œæ¸²æŸ“ã€‚Cesium æä¾›äº†è®¸å¤šå†…ç½®çš„æ•°æ®æºå’Œæ ¼å¼ï¼Œå¦‚ `GeoJSON`ã€`KML`ã€`CSV `ç­‰ï¼Œä¹Ÿæ”¯æŒè‡ªå®šä¹‰æ•°æ®æºå’Œæ ¼ å¼ã€‚ 

ï¼ˆ2ï¼‰`ImageryProvider`

`ImageryProvider `æ˜¯ä¸€ç§è¡¨ç¤ºåœ°å›¾å›¾åƒæ•°æ®çš„æ¦‚å¿µï¼Œå®ƒå¯ä»¥ä»ä¸åŒçš„åœ°å›¾æœåŠ¡æˆ–æ•°æ®æºä¸­ åŠ è½½å›¾åƒï¼Œå¹¶åœ¨`Cesium`åœºæ™¯ä¸­æ˜¾ç¤ºã€‚`Cesium`æä¾›äº†è®¸å¤šå†…ç½®çš„`ImageryProvider`ï¼Œå¦‚`Bing Maps`ã€` Google Maps`ã€`OpenStreetMap `ç­‰ï¼Œä¹Ÿæ”¯æŒè‡ªå®šä¹‰ `ImageryProvider `å’Œå›¾åƒæ ¼å¼ã€‚ 

ï¼ˆ3ï¼‰`TerrainProvider `

`TerrainProvider `æ˜¯ä¸€ç§è¡¨ç¤ºåœ°å½¢æ•°æ®çš„æ¦‚å¿µï¼Œå®ƒå¯ä»¥ä»ä¸åŒçš„åœ°å½¢æœåŠ¡æˆ–æ•°æ®æºä¸­åŠ è½½ åœ°å½¢æ•°æ®ï¼Œå¹¶åœ¨`Cesium`åœºæ™¯ä¸­æ˜¾ç¤ºã€‚`Cesium`æä¾›äº†è®¸å¤šå†…ç½®çš„`TerrainProvider`ï¼Œå¦‚`STK Terrain`ã€` Mapbox Terrain`ã€`Cesium World Terrain` ç­‰ï¼Œä¹Ÿæ”¯æŒè‡ªå®šä¹‰ `TerrainProvider `å’Œåœ°å½¢æ ¼å¼ã€‚ æ‰€ä»¥åŠ è½½çš„æ•°æ®å°†ä¼šæ ¹æ®æ•°æ®ç±»å‹ï¼Œè¢«åˆ†ä¸º `PrimitiveCollection`ã€`DataSourceCollection `å’Œ `EntityCollection `ä¸‰ ç±» ã€‚ ç”¨ æˆ· åˆ› å»º çš„ `Primitive `å’Œ `Entity `è¢« æ”¾ åœ¨ `PrimitiveCollection `å’Œ `EntityCollection `ä¸­ï¼Œè€ŒåŠ è½½çš„æ•°æ®è¢«æ”¾åœ¨ `DataSourceCollection `ä¸­ã€‚

####  Cesium ä¸»è¦ç±»å’Œå¯¹è±¡

é™¤äº†å’Œæ•°æ®æœ‰å…³çš„ç±»å’Œå¯¹è±¡å¤–ï¼Œ`Cesium `è¿˜åŒ…æ‹¬ä¸€äº›åœºæ™¯æ§åˆ¶çš„é‡è¦å¯¹è±¡ã€‚ 

ï¼ˆ1ï¼‰`Viewer`ï¼š`Viewer `æ˜¯ `Cesium `ä¸­çš„é¡¶å±‚å¯¹è±¡ï¼Œè¡¨ç¤ºæ•´ä¸ª `Cesium `åœºæ™¯çš„çŠ¶æ€å’Œå±æ€§ã€‚ å®ƒåŒ…å«äº†ä¸€ä¸ª `Scene `å¯¹è±¡ï¼Œç”¨äºç®¡ç†åœºæ™¯ä¸­çš„å„ç§å¯¹è±¡å’Œå±æ€§ï¼Œå¦‚åœ°çƒã€ç›¸æœºã€å…‰æºã€å›¾å±‚ã€ æ•°æ®æºç­‰ã€‚ 

ï¼ˆ2ï¼‰`Camera`ï¼š`Camera `è¡¨ç¤º `Cesium `åœºæ™¯ä¸­çš„ç›¸æœºï¼Œç”¨äºæ§åˆ¶åœºæ™¯çš„è§†è§’ã€ä½ç½®ã€æ–¹å‘ã€ ç¼©æ”¾ç­‰å±æ€§ã€‚`Camera `æä¾›äº†è®¸å¤šç›¸æœºæ“ä½œå’ŒåŠ¨ç”»æ•ˆæœï¼Œå¦‚å¹³ç§»ã€æ—‹è½¬ã€ç¼©æ”¾ã€é£è¡Œç­‰ã€‚

ï¼ˆ3ï¼‰`Ellipsoid`ï¼š`Ellipsoid` è¡¨ç¤º `Cesium `åœºæ™¯ä¸­çš„åœ°çƒæ¤­çƒä½“æ¨¡å‹ï¼Œç”¨äºå®šä¹‰åœ°çƒçš„å½¢çŠ¶ å’Œå¤§å°ã€‚`Ellipsoid `å¯ä»¥å…·æœ‰ä¸åŒçš„åŠå¾„ã€è½´æ¯”ä¾‹ç­‰å±æ€§ã€‚

##  TASK 3

###  æ€»ä½“è®¾è®¡

é€šè¿‡åº•éƒ¨å¯¼èˆªæ è¿›è¡Œåˆ‡æ¢ã€‚

<center class="half">
    <img src="README.assets/image-20230428103105333.png" width="250"/>
    <img src="README.assets/image-20230428103200959.png" width="250"/>
    <img src="README.assets/image-20230428103337288.png" width="250"/>
    <img src="README.assets/image-20230428103427074.png" width="250"/>
</center>


###  æ®µæ–‡è±ª

####  åº•å›¾åŠ è½½

1. åŠ è½½å¤©åœ°å›¾

åœ¨å¤©åœ°å›¾ç”³è¯·`token`ï¼Œç„¶åé€šè¿‡`http://t7.tianditu.gov.cn/vec_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=vec&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILECOL={x}&TILEROW={y}&TILEMATRIX={z}&tk="ä½ çš„token"`æ¥è·å–åœ°å›¾æœåŠ¡ã€‚

```javascript
var vecSource = {
    "type": "raster",
    'tiles': [ "http://t7.tianditu.gov.cn/vec_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=vec&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILECOL={x}&TILEROW={y}&TILEMATRIX={z}&tk=f5347cab4b28410a6e8ba5143e3d5a35"
    ],
    'tileSize': 256
};
var cvaSource = {
    "type": "raster",
    'tiles': [
"http://t7.tianditu.gov.cn/cva_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=cva&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILECOL={x}&TILEROW={y}&TILEMATRIX={z}&tk=f5347cab4b28410a6e8ba5143e3d5a35"
    ],
    'tileSize': 256
};

// çŸ¢é‡å›¾å±‚
var vecLayer = {
    "id": "vecsrc",
    "type": "raster",
    "source": "vecsrc",
    "minzoom": 0,
    "maxzoom": 20
};
var cvaLayer = {
    "id": "cvasrc",
    "type": "raster",
    "source": "cvasrc",
    "minzoom": 0,
    "maxzoom": 20
};


var map = new mapboxgl.Map({
    // åœ°å›¾å®¹å™¨divçš„id
    container: 'mb-map', // container id
    style: {
        //è®¾ç½®ç‰ˆæœ¬å·ï¼Œä¸€å®šè¦è®¾ç½®
        "version": 8,
        //æ·»åŠ æ¥æº
        "sources": {
            "vecsrc": vecSource,
            "cvasrc": cvaSource,
        },
        //è®¾ç½®åŠ è½½å¹¶æ˜¾ç¤ºæ¥æºçš„å›¾å±‚ä¿¡æ¯
        "layers": [vecLayer, cvaLayer],
    },
    center: [114.339408, 30.61271],
    zoom:6,
});
```

![image-20230428094933370](README.assets/image-20230428094933370.png)

2. åŠ è½½`mapbox`çš„çŸ¢é‡å›¾å±‚(ä¸å»ºè®®)

`mapbox`è‡ªå¸¦è®¸å¤šæ ·å¼å›¾å±‚ï¼Œæœ‰`light`ã€`dark`ã€`img`

```javascript
style: "mapbox://styles/mapbox/streets-v10",
```

ä¸Šè¿°æ”¾å…¥`map`åˆå§‹åŒ–ä¸­ã€‚

![image-20230428095144425](README.assets/image-20230428095144425.png)

####  æ§ä»¶è®¾è®¡

1. å…¨å±æ§ä»¶

æ·»åŠ äº†ä¸€ä¸ªå¯ç‚¹å‡»çš„åœ°å›¾æ§ä»¶ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿåˆ‡æ¢å…¨å±æ¨¡å¼çš„å¼€å¯å’Œå…³é—­ã€‚

```javascript
map.addControl(new mapboxgl.FullscreenControl());
```

![image-20230428095542302](README.assets/image-20230428095542302.png)

2. æ˜¾ç¤ºç¼©æ”¾å’Œæ—‹è½¬æ§ä»¶

ç”¨äºç¼©æ”¾å’Œæ—‹è½¬è°ƒæ•´ã€‚

```javascript
map.addControl(new mapboxgl.NavigationControl());
```

![image-20230428095811272](README.assets/image-20230428095811272.png)

3. å¸§ç‡æ˜¾ç¤ºæ§ä»¶

```javascript
map.addControl(new mapboxgl.FrameRateControl());
```

![image-20230428100007690](README.assets/image-20230428100007690.png)

4. å¯¼èˆªæ§ä»¶

ä½¿ç”¨`mapbox-gl-directions`æ’ä»¶æ¥æ˜¾ç¤ºæ¥è‡ª`Mapbox Directions API`çš„ç»“æœã€‚ç‚¹å‡»åœ°å›¾ï¼Œæ·»åŠ å‡ºå‘åœ°å’Œç›®çš„åœ°ï¼Œå¹¶ä½¿ç”¨åˆ‡æ¢é”®åœ¨å¯ç”¨çš„è·¯çº¿é…ç½®ä¸­è¿›è¡Œåˆ‡æ¢ã€‚

```javascript
var directions = new MapboxDirections({
    accessToken: 'pk.eyJ1Ijoienp6aWlpIiwiYSI6ImNsYmV1cWtqaTAwMWMzbnM3cGYzdG9xanEifQ.Y8VtfjgM1lBszfFHVoDsFw',
    unit: 'metric',
    profile: 'mapbox/cycling'
  });

map.addControl(directions, 'top-left');
```

<img src="README.assets/image-20230428100216582.png" alt="image-20230428100216582" style="zoom:50%;" />

5. é¹°çœ¼æ§ä»¶

`mapbox`æ²¡æœ‰æä¾›æœ‰å…³çš„æ§ä»¶å’Œæ’ä»¶ï¼Œéœ€è¦è‡ªå·±å†™ä¸€ä¸ªã€‚

```javascript
function Minimap ( options )
{
	Object.assign(this.options, options);

	this._ticking = false;
	this._lastMouseMoveEvent = null;
	this._parentMap = null;
	this._isDragging = false;
	this._isCursorOverFeature = false;
	this._previousPoint = [0, 0];
	this._currentPoint = [0, 0];
	this._trackingRectCoordinates = [[[], [], [], [], []]];
}

	options: {
		id: "mapboxgl-minimap",
		width: "320px",
		height: "180px",
		style: "mapbox://styles/mapbox/streets-v10",
		center: [114.339408, 30.61271],
		zoom: 6,

		// should be a function; will be bound to Minimap
		zoomAdjust: null,

		// if parent map zoom >= 18 and minimap zoom >= 14, set minimap zoom to 16
		zoomLevels: [
			[18, 14, 16],
			[16, 12, 14],
			[14, 10, 12],
			[12, 8, 10],
			[10, 6, 8]
		],

		lineColor: "#08F",
		lineWidth: 1,
		lineOpacity: 1,

		fillColor: "#F80",
		fillOpacity: 0.25,

		dragPan: false,
		scrollZoom: true,
		boxZoom: false,
		dragRotate: false,
		keyboard: false,
		doubleClickZoom: false,
		touchZoomRotate: false
	},
```

è¯¦ç»†ç»†èŠ‚è§`mapbox-mini.js`ã€‚

![image-20230428100512511](README.assets/image-20230428100512511.png)

####  å‡å­¦è·¯çº¿

1. åŠ å…¥å­¦æ ¡`source`ï¼Œæ˜¾ç¤ºå°å­¦ã€åˆä¸­ã€é«˜ä¸­ã€å¤§å­¦ã€ç ”ç©¶ç”Ÿçš„å­¦æ ¡ã€‚

   è¯¥æ•°æ®ä»¥`geojson`æ ¼å¼ç¼–è¾‘ï¼Œä¸”`description`ä¸º`html`çš„å¯Œæ–‡æœ¬å½¢å¼ï¼Œå¯ä»¥åœ¨åç»­ç›´æ¥æ’å…¥ä¸éœ€è¦è¿›è¡Œè§£æã€‚

```javascript
map.addSource('places', {
        'type': 'geojson',
        'data': {
            'type': 'FeatureCollection',
            'features': [
                {
                    'type': 'Feature',
                    'properties': {
                        'description':
                        '<h2>ç¦¾é’ä¸­å¿ƒå­¦æ ¡</h2><p><strong>å°å­¦ã€åˆä¸­</strong>ã€‚æˆ‘åœ¨è¿™ä¸ªå­¦æ ¡å¾…äº†10å¹´,ä»å­¦å‰ç­åˆ°åˆä¸‰ä¸€ç›´åœ¨è¿™é‡Œæ¥å—æ•™è‚²ã€‚ç°å·²æ”¹åä¸ºç¦¾é’èŠ™è“‰å­¦æ ¡</p>',
                        'icon': 'school'
                    },
                    'geometry': {
                        'type': 'Point',
                        'coordinates': juniorSchool
                    }
                },
                {
                    'type': 'Feature',
                    'properties': {
                        'description':
                            '<h2>å†·æ°´æ±Ÿå¸‚ç¬¬ä¸€ä¸­å­¦</h2><p><strong>é«˜ä¸­å­¦æ ¡</strong>ã€‚åœ¨99å¹´å‡ºäº†æ–‡ç†ç§‘çŠ¶å…ƒï¼Œå› æ­¤åœ¨æˆ‘ä»¬åœ°çº§å¸‚å‡ºåï¼Œç°é˜¶æ®µçš„ä¸€ä¸­æ•™å­¦è´¨é‡å‡ºç°äº†ä¸¥é‡ä¸‹æ»‘ã€‚</p>',
                        'icon': 'school'
                    },
                    'geometry': {
                        'type': 'Point',
                        'coordinates': seniorSchool
                    }
                },
                {
                    'type': 'Feature',
                    'properties': {
                        'description':
                            '<h2>ä¸­å›½åœ°è´¨å¤§å­¦(æ­¦æ±‰)</h2><p><strong>å¤§å­¦</strong>ã€‚2020å¹´æˆ‘æ¥åˆ°ä¸­å›½åœ°è´¨å¤§å­¦æ±‚å­¦ï¼Œé€‰æ‹©äº†æµ‹ç»˜ç±»ä¸“ä¸šï¼Œåˆ†æµè‡³åœ°ç†ç©ºé—´ä¿¡æ¯å·¥ç¨‹ã€‚ç°é˜¶æ®µç ”ç©¶æ–¹å‘æ˜¯é¥æ„Ÿæ™ºèƒ½è§£ç–‘ç®—æ³•ã€‚</p>',
                        'icon': 'school'
                    },
                    'geometry': {
                        'type': 'Point',
                        'coordinates': undergraduate
                    }
                },
                {
                    'type': 'Feature',
                    'properties': {
                        'description':
                            '<h2>ä¸­å›½ç§‘å­¦é™¢ç©ºå¤©ä¿¡æ¯åˆ›æ–°ç ”ç©¶é™¢</h2><p><strong>ç ”ç©¶ç”Ÿä¸åšå£«</strong>ã€‚å¸Œæœ›ä»Šå¹´å¯ä»¥é¡ºåˆ©å‡å­¦ï¼Œç„¶åå°±å¯ä»¥å…¨å¿ƒèº«æŠ•å…¥åˆ°ç§‘ç ”ä¹‹ä¸­äº†ï¼</p>',
                        'icon': 'school'
                    },
                    'geometry': {
                        'type': 'Point',
                        'coordinates': graduate
                    }
                },
            ]
        }
    });
```

2. è‡ªå®šä¹‰`icon`ï¼ŒåŠ å…¥å­¦æ ¡ğŸ«å›¾æ ‡å’Œé£æœºâœˆçš„å›¾æ ‡

```javascript
// åŠ è½½è‡ªå®šä¹‰icon
map.loadImage('./imgs/school.png',(error, image) => {
    if(error) throw error;
    map.addImage('school', image);
    console.log('school init')
})

// åŠ è½½è‡ªå®šä¹‰icon
map.loadImage('./imgs/airport.png',(error, image) => {
    if(error) throw error;
    map.addImage('myAirport', image);
    console.log('airport init')
    map.addLayer({
        'id': 'point',
        'source': 'point',
        'type': 'symbol',
        'layout': {
            // To add a new image to the style at runtime see
            // https://docs.mapbox.com/mapbox-gl-js/example/add-image/
            'icon-image': 'myAirport',
            'icon-size': 1.,
            'icon-rotate': ['get', 'bearing'],
            'icon-rotation-alignment': 'map',
            'icon-allow-overlap': true,
            'icon-ignore-placement': true
        }
    });
})
```

3. å°†å­¦æ ¡é—´è¿æ¥èµ·æ¥ï¼Œå¹¶åŠ å…¥é£æœºé£è¡ŒåŠ¨ç”»æ¨¡æ‹Ÿæˆ‘çš„è·¯çº¿è½¨è¿¹ã€‚

```javascript
// ç®­å¤´-å³
var svgXML =
`<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"> 
    <path d="M529.6128 512L239.9232 222.4128 384.7168 77.5168 819.2 512 384.7168 946.4832 239.9232 801.5872z" p-id="9085" fill="#ffffff"></path> 
</svg>
`
var svgBase64 = 'data:image/svg+xml;base64,' + window.btoa(unescape(encodeURIComponent(svgXML)));
const juniorSchool = [111.432383, 27.608648]
const seniorSchool = [111.440355, 27.691964]
const undergraduate = [114.617146, 30.457564]
const graduate = [116.281528, 40.072093]
// è·¯çº¿
const route = {
    'type': 'FeatureCollection',
    'features': [
        {
        'type': 'Feature',
        'geometry': {
            'type': 'LineString',
            'coordinates': [juniorSchool, seniorSchool, undergraduate, graduate]
            }
        }
    ]
};
var realroute = {
    'type': 'FeatureCollection',
    'features':[{
        'type': 'Feature',
        'geometry': {
            'type': 'LineString',
            'coordinates': []
        }
    }]
}
// æ²¿è·¯çº¿è¿åŠ¨çš„ç‚¹.
// ä»¥åˆå§‹ç‚¹åˆå§‹åŒ–.
const point = {
    'type': 'FeatureCollection',
    'features': [
        {
        'type': 'Feature',
        'properties': {},
            'geometry': {
            'type': 'Point',
            'coordinates': juniorSchool
            }
        }
    ]
};
// è®¡ç®—è·ç¦».
const lineDistance = turf.length(route.features[0]);
const arc = [];
//åœ¨å¼§çº¿å’ŒåŠ¨ç”»ä¸­ä½¿ç”¨çš„æ­¥éª¤æ•°ï¼Œæ›´å¤šçš„æ­¥éª¤è¡¨ç¤º
//å¹³æ»‘çš„å¼§çº¿å’ŒåŠ¨ç”»ï¼Œä½†è¿‡å¤šçš„æ­¥éª¤å°†å¯¼è‡´
//ä½å¸§é€Ÿç‡
const steps = 500;
// åœ¨ä¸¤ä¸ªç‚¹çš„â€œèµ·ç‚¹â€å’Œâ€œç»ˆç‚¹â€ä¹‹é—´ç”»ä¸€æ¡å¼§
for (let i = 0; i < lineDistance; i += lineDistance / steps) {
    const segment = turf.along(route.features[0], i);
    arc.push(segment.geometry.coordinates);
}
// æ ¹æ®å¼§åæ ‡æ›´æ–°route
route.features[0].geometry.coordinates = arc;
// ç”¨äºæ ¹æ®routeå¢åŠ ç‚¹æµ‹é‡å€¼.
let counter = 0;
map.on('load', () => {
    let arrowIcon = new Image(20, 20)
    arrowIcon.src = svgBase64
    arrowIcon.onload = function() {
        map.addImage('arrowIcon', arrowIcon)
        console.log('arrow')
    }
    map.addSource('route', {
        'type': 'geojson',
        'data': route
    });
    map.addSource('realroute',{
        'type': 'geojson',
        'data': realroute
    }) 
    map.addSource('point', {
        'type': 'geojson',
        'data': point
    });  
    map.addLayer({
        'id': 'route',
        'source': 'route',
        'type': 'line',
        'paint': {
            'line-width': 5,
            'line-opacity': 1,
            'line-color': '#007cbf'
        }   
    });
    map.addLayer({
        'id': 'realroute',
        'type': 'line',
        'source': 'realroute',
        'paint': {
            'line-width': 5,
            'line-opacity': 1,
            'line-color': '#FF9900',
        }
    });
    map.addLayer({
        'id': 'arrawLayer',
        'type': 'symbol',
        'source': 'route',
        'layout': {
            'symbol-placement':'line',
            'symbol-spacing': 50,
            'icon-image': 'arrowIcon',
            'icon-size': 0.25
        }
    })
```

ä¸€å…±ä¸‰ä¸ªå›¾å±‚ï¼Œä¸€ä¸ªé™æ€è·¯çº¿`route`ã€åŠ¨æ€è·¯çº¿`realroute`ã€ç®­å¤´å›¾å±‚`arrawLayer`ã€‚

4. `popup`å¼¹å‡ºæ¡†

ç‚¹å‡»æ¯ä¸ªå­¦æ ¡ï¼Œå¼¹å‡ºå¼¹å‡ºæ¡†ï¼Œå±•ç¤ºåŸºæœ¬ä¿¡æ¯ã€‚

```javascript
map.on('click', 'places', (e) => {
        const coordinates = e.features[0].geometry.coordinates.slice();
        const description = e.features[0].properties.description;
        while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
            coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
        } 
        new mapboxgl.Popup()
            .setLngLat(coordinates)
            .setHTML(description)
            .addTo(map);
    });
    map.on('mouseenter', 'places', () => {
        map.getCanvas().style.cursor = 'pointer';
    });
    map.on('mouseleave', 'places', () => {
        map.getCanvas().style.cursor = '';
    });
```

5. `flyto()`

`maobox`è‡ªå¸¦ä¸€ä¸ªåˆ‡æ¢è§†è§’çš„å‡½æ•°ï¼Œ`flyto()`ã€‚ä¸”åœ¨åˆ‡æ¢è¿‡ç¨‹ä¸­ï¼Œå¸¦æœ‰ç¼©æ”¾ã€æ—‹è½¬ã€‚

```javascript
function flytoJunior(){
    const start = {
        center: [114.339408, 30.61271],
        zoom: 6,
        pitch: 0,
        bearing: 0
    };
    const end = {
        center: juniorSchool,
        zoom: 12.5,
        bearing: 130,
        pitch: 75
    };
    const target = isAtStart ? end : start;
    isAtStart = !isAtStart;
    map.flyTo({
        ...target,
        duration: 12000,
        essential: true
    });
}
```

åŒæ—¶è®¾ç½®å››ä¸ªæŒ‰é’®ï¼Œç”¨äºåˆ‡æ¢è·³è½¬ã€‚

```html
<div class="overlay">
    <button id="replay">Replay</button>
    <button onclick="flytoJunior()">å°å­¦ã€åˆä¸­</button>
    <button onclick="flytoSenior()">é«˜ä¸­</button>
    <button onclick="flytoUndergraduate()">å¤§å­¦</button>
    <button onclick="flytoGraduate()">ç ”ç©¶ç”Ÿ</button>
</div>
```

è¿™ä¸€`button`ç»„æœ‰ä¸€æµç•…çš„åŠ¨ç”»æ•ˆæœï¼Œé€šè¿‡`css`å®ç°çš„ã€‚

```css
.overlay button {
        font: 600 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
        color: #fff;
        display: inline-block;
        margin: 0;
        padding: 10px 20px;
        border: none;
        cursor: pointer;
        border-radius: 3px;
        outline: none;
        z-index: 1;
        position: relative;
        font-size: inherit;
        font-family: inherit;
        background-color: hsl(236, 32%, 26%);
    }
    .overlay button::before {
        content: '';
        z-index: -1;
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: #fc2f70;
        transform-origin: center right;
        transform: scaleX(0);
        transition: transform 0.25s ease-in-out;
        border-radius: 3px;

    }
    .overlay button:hover {
        cursor: pointer;
    }
    
    .overlay button:hover::before {
        transform-origin: center left;
        transform: scaleX(1);
    }
    .overlay button:disabled {
        background: #f5f5f5;
        color: #c3c3c3;
    }
```

ä¸Šè¿°ä¸ºå…¨éƒ¨å†…å®¹ï¼Œæ•´ä½“æ•ˆæœå¦‚ä¸‹ã€‚



<center class="half">
    <img src="README.assets/image-20230428102505478.png" width="250"/>
    <img src="README.assets/image-20230428102526697.png" width="250"/>
    <img src="README.assets/image-20230428102616482.png" width="250"/>
    <img src="README.assets/image-20230428102710771.png" width="250"/>
</center>





###  æ®·é¹æˆ



###  å¼ æ¢“å…ƒ

1. æ„å»ºåŸºæœ¬åœºæ™¯ï¼Œåˆ›å»ºä¸€ä¸ª `div `ä½œä¸º `Cesium `å®¹å™¨ï¼Œåˆ©ç”¨ `new Cesium.Viewer `å‡½æ•°åˆ›å»º `Viewer `å¹¶è®¾ç½® `Cesium `å†…ç½®æ§ä»¶çš„æ˜¾ç¤ºä¸éšè—å’Œç¼©æ”¾çº§åˆ«ç­‰å®¹å™¨å±æ€§ã€‚
2. åˆ©ç”¨ `viewer.imageryLayers.addImageryProvider` å‡½æ•°åŠ è½½å¤©åœ°å›¾çŸ¢é‡åœ°å›¾ã€å½±åƒåº•å›¾ å’Œåœ°å½¢å›¾ç­‰ï¼Œé€šè¿‡ `Cesium.WebMapTileServiceImageryProvider` åˆ›å»ºåœ°å›¾æœåŠ¡çš„ Rest è¯·æ±‚ã€‚ å°†åŠ è½½çš„å›¾å±‚ä¿å­˜åˆ°æ•°ç»„ä¸­ï¼Œåˆ›å»ºå›¾å±‚æ§ä»¶ï¼Œæ§åˆ¶å›¾å±‚çš„æ˜¾ç¤ºå’Œéšè—ã€‚

```javascript
let TDTLayer_cva = viewer.imageryLayers.addImageryProvider(new Cesium.
WebMapTileServiceImageryProvider({
//å¤©åœ°å›¾ URL
url: "http://t0.tianditu.gov.cn/cva_w/wmts?tk=f581acc25f8c0a5453d4f5c4e87fc8ff",
//å›¾å±‚åç§°ï¼Œvecï¼šçŸ¢é‡åº•å›¾ã€imgï¼šå«æ˜Ÿå½±åƒåº•å›¾ã€cva: çŸ¢é‡æ³¨è®°å›¾å±‚ï¼ˆä¸­æ–‡ï¼‰ã€eva: çŸ¢é‡æ³¨è®°å›¾å±‚ï¼ˆè‹±æ–‡ï¼‰ã€cia: æ³¨è®°å›¾å±‚ï¼ˆä¸­æ–‡ï¼‰ã€eia: æ³¨è®°å›¾å±‚ï¼ˆè‹±æ–‡ï¼‰ã€ter: åœ°å½¢æ™•æ¸²åº•å›¾ã€cta: æ³¨è®°ï¼ˆä¸­æ–‡ï¼‰ã€ibo: å…¨çƒå›½ç•Œ
layer: "cva",
//ç“¦ç‰‡æ ·å¼
style: "default",
//æ¯”ä¾‹å°º
tileMatrixSetID: "w",
//è¯·æ±‚æ ¼å¼
format: "tiles",
// è®¾ç½®å¤©åœ°å›¾ç“¦ç‰‡çº§åˆ«ï¼ˆå¾ˆå…³é”®ï¼‰
maximumLevel: 18
}));
```

åˆ©ç”¨å›¾å±‚æ§ä»¶åˆ‡æ¢å›¾å±‚æ•ˆæœå¦‚ä¸‹æ‰€ç¤ºã€‚

<center class="half">
    <img src="README.assets/image-20230428093031023.png" width="300"/>
    <img src="README.assets/image-20230428093059855.png" width="300"/>
</center>

3. æ·»åŠ å¸¸ç”¨åœ°å›¾æ§ä»¶ã€‚`Cesium `æ²¡æœ‰å†…ç½®çš„æ¯”ä¾‹å°ºã€ç½—ç›˜ç­‰ï¼Œéœ€è¦é€šè¿‡ç¬¬ä¸‰æ–¹åº“ `Cesium-navigation` åŠ è½½ã€‚ä¸‹è½½è¯¥åº“ï¼Œå¹¶ç”¨å…¶æä¾›çš„æ¥å£æ·»åŠ æ¯”ä¾‹å°ºã€ç½—ç›˜ç­‰åœ°å›¾æ§ä»¶ã€‚
4. è· å¾— å­¦ æ ¡ çš„ å æ ‡ æ•° æ® å’Œ å± æ€§ ä¿¡ æ¯ ï¼Œ å¹¶ ä»¥ `GeoJSON `çš„ å½¢ å¼ ä¿ å­˜ ã€‚ åˆ© ç”¨ `Cesium.GeoJsonDataSource.load `å‡½ æ•° å¯ ä»¥ å°† `Ajax `è¯· æ±‚ åˆ° çš„ `GeoJSON `æ•° æ® åˆ› å»º æˆ `GeoJsonDataSource`ï¼Œå¹¶éå†å®ä½“ï¼Œè®¾ç½®å®ä½“çš„æ ·å¼ã€‚

```javascript
entities.forEach(entity => {
// é‡ç½®å›¾ç‰‡ï¼Œå›¾ç‰‡å¤§å°ï¼Œå¤§å°å•ä½ä¸ºç±³
entity.billboard.image = '../asset/image/å­¦æ ¡.png'
entity.billboard.width = 40;
entity.billboard.height = 40;
entity.billboard.sizeInMeters = false;
}
```

å­¦æ ¡çš„ `GeoJson `æ•°æ®æ˜¾ç¤ºå¦‚ä¸‹å›¾ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªè¡¨æ ¼ï¼Œç”¨äºé™ˆåˆ—å­¦æ ¡ä¿¡æ¯ã€‚

![image-20230428093358326](README.assets/image-20230428093358326.png)

5.  è®¾ç½®è·³è½¬

`Cesium `çš„è·³è½¬åŠ¨ç”»å¯ä»¥é€šè¿‡è®¾ç½®ç›¸æœºï¼ˆ`Camera`ï¼‰æˆ–è§†å›¾ï¼ˆ`Viewer`ï¼‰çš„ç§»åŠ¨æ¥è®¾ç½®é£è¡Œ æ•ˆæœã€‚ç›¸æœºè·³è½¬æ˜¯æŒ‡ç›´æ¥æ“ä½œåœºæ™¯ä¸­çš„ç›¸æœºå¯¹è±¡ï¼Œæ§åˆ¶ç›¸æœºçš„ä½ç½®ã€æ–¹å‘ã€ç¼©æ”¾ç­‰å±æ€§ï¼Œä» è€Œæ”¹å˜åœºæ™¯çš„è§†è§’å’Œæ˜¾ç¤ºæ•ˆæœï¼Œ`Cesium `æä¾›äº†å¤šç§ç›¸æœºæ“ä½œå’ŒåŠ¨ç”»æ•ˆæœï¼Œå¦‚å¹³ç§»ã€æ—‹è½¬ã€ ç¼©æ”¾ã€é£è¡Œç­‰ï¼Œå¯ä»¥é€šè¿‡ `Camera `å¯¹è±¡å’Œ `Camera` æ“ä½œæ–¹æ³•æ¥å®ç°ã€‚

```javascript
viewer.camera.flyTo({
destination: Cesium.Cartesian3.fromDegrees(longitude, latitude, height),
duration: 3
});
```

`Viewer `è·³è½¬æ˜¯æŒ‡ç›´æ¥æ“ä½œåœºæ™¯ä¸­çš„ `Viewer `å¯¹è±¡ï¼Œæ§åˆ¶åœºæ™¯çš„çŠ¶æ€å’Œå±æ€§ï¼Œä»è€Œæ”¹å˜æ•´ ä¸ªåœºæ™¯çš„æ˜¾ç¤ºæ•ˆæœã€‚`Viewer `è·³è½¬å¯ä»¥æ”¹å˜åœºæ™¯çš„æ—¶é—´ã€ä½ç½®ã€å§¿æ€ã€åœ°å½¢ã€å›¾å±‚ã€ç›¸æœºç­‰ å±æ€§ï¼Œå¯ä»¥é€šè¿‡ `Viewer `å¯¹è±¡å’Œ `Viewer `æ“ä½œæ–¹æ³•æ¥å®ç°ã€‚

```javascript
 viewer.camera.setView({
    destination: Cesium.Cartesian3.fromDegrees(longitude, latitude, height),
    orientation: {
        heading: Cesium.Math.toRadians(0),
        pitch: Cesium.Math.toRadians(-90),
        roll: Cesium.Math.toRadians(0)
        }
});
```

æœ¬æ¡ˆä¾‹é€šè¿‡ `viewer.camera.flyTo` å®ç°è·³è½¬æ•ˆæœã€‚ç‚¹å‡»è¡¨æ ¼ä¸­çš„å­¦æ ¡åç§°ï¼Œå³å¯è§¦å‘è§†å›¾ çš„é£è¡ŒåŠ¨ç”»ï¼Œå°†è§†å›¾è·³è½¬è‡³å­¦æ ¡æ‰€åœ¨ä½ç½®ã€‚

![image-20230428093712392](README.assets/image-20230428093712392.png)

###  æœ±æŸå†°

ç”±äºåœ¨å®ä¹ äºŒä¸­æˆ‘å·²ç»å®ç°äº†ç»˜å›¾æ§ä»¶ï¼Œå› æ­¤æˆ‘åœ¨è¯¥åŸºç¡€ä¸Šï¼Œç»§ç»­åŠ å…¥äº†å…¶ä»–æ§ä»¶åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ¯”ä¾‹å°ºæ§ä»¶ã€å…¨å±æŸ¥çœ‹æ§ä»¶å’Œé¼ æ ‡ä½ç½®æ§ä»¶ã€‚å®ç°æ–¹å¼å¦‚ä¸‹ï¼š

å°†ç»˜å›¾åŠŸèƒ½å°è£…åˆ°æ§ä»¶ä¸­ï¼Œä½œä¸ºå·¥å…·ï¼Œæ›´åˆ©äºä½¿ç”¨ã€‚é¦–å…ˆç¡®å®šå®ç°è¯¥æ§ä»¶çš„æ‰€æœ‰éœ€æ±‚ï¼šï¼ˆ1ï¼‰å…·æœ‰ä¸€ä¸ªå·¥å…·æ¡ï¼ŒåŒ…å«æŒ‡é’ˆã€ç»˜ç‚¹ã€ç»˜çº¿ã€ç»˜é¢ã€ç»˜åœ†ã€ç»˜çŸ©å½¢ã€æ¸…ç©ºç»˜åˆ¶è¿™7ä¸ªæŒ‰é’®ï¼›
ï¼ˆ2ï¼‰å•å‡»å„ä¸ªç»˜å›¾æŒ‰é’®å°†åˆ‡æ¢è‡³å¯¹åº”çš„ç»˜å›¾çŠ¶æ€ï¼›
ï¼ˆ3ï¼‰å•å‡»æŒ‡é’ˆæŒ‰é’®åˆ‡æ¢ä¸ºéç»˜å›¾çŠ¶æ€ï¼›
ï¼ˆ4ï¼‰å•å‡»æ¸…ç©ºç»˜åˆ¶æ¸…ç†æ‰æ‰€æœ‰å·²ç»˜åˆ¶çš„å›¾å½¢ã€‚

ä»£ç å®ç°ï¼š

ï¼ˆ1ï¼‰`ol.control.Control`ç±»æ˜¯`openlayers`ä¸­æ‰€æœ‰æ§ä»¶çš„åŸºç±»ï¼Œè‡ªå®šä¹‰ç»˜å›¾æ§ä»¶ï¼Œä»¥ç»§æ‰¿è¯¥ç±»ã€‚

ï¼ˆ2ï¼‰å®šä¹‰æŒ‰é’®ã€‚

  å®šä¹‰`source_`å¯¹è±¡ç”¨äºåç»­è·å–å›¾å±‚ï¼Œå®šä¹‰`drawing_`å¯¹è±¡ç”¨äºåç»­å®ç°äº¤äº’ç»˜åˆ¶ã€‚å®šä¹‰æŒ‰é’®ä¸­æŒ‡é’ˆã€ç»˜ç‚¹ã€ç»˜çº¿ã€ç»˜é¢ã€ç»˜åœ†ã€ç»˜çŸ©å½¢ã€æ¸…ç©ºåŠŸèƒ½çš„åç§°åˆ†åˆ«ä¸º`'None'`, `'Point'`, `'LineString'`, `'Polygon'`, `'Circle'`, `'Box'`, `'Clear'`åˆ©ç”¨`document.createElement('div')`ç”Ÿæˆä¸€ä¸ªdivæ ‡ç­¾ï¼Œè®¾ç½®å„æŒ‰é’®çš„å…ƒç´ çš„`class`å±æ€§åç§°ã€‚

```javascript
this.source_ = undefined;
this.drawing_ = undefined;
this.drawType = ['None', 'Point', 'LineString', 'Polygon', 'Circle', 'Box', 'Clear'];
var defaultControlClassName = 'ol-unselectable ol-control';
this.element = document.createElement('div');
this.element.className = defaultControlClassName + ' ' + 'drawtools';
```

é€šè¿‡`document.createElement('button')`åˆ›å»ºæŒ‰é’®ï¼Œè®¾ç½®æŒ‰é’®çš„å±æ€§ã€‚

```javascript
var createchildElement = function(options){
    var btn = document.createElement('button');
    btn.className = options.class;
    btn.id = options.id;
    var tipLable = 'Draw ' + options.value;
    btn.title = tipLable;
    btn.type = options.type;
    btn.value = options.value;
    return btn;
};
```

ä¸ºæŒ‰é’®ä¸åç§°å»ºç«‹ä¸€ä¸€å¯¹åº”å…³ç³»ï¼Œè®¾ç½®æŒ‰é’®çš„æ ·å¼ã€‚

```javascript
this.drawType.forEach(element => {
    var btn = createchildElement({
        type: 'button',
        class: 'drawBtn',
        value: element,
        id: 'ol-draw-' + element.toLocaleLowerCase()
    })
    btn.onclick = function(evt){
        evt.preventDefault();
        this.btnFouceChanged(evt);
        var value = evt.target.getAttribute('value');
        this.addInteraction(value);
    }.bind(this);
    this.element.appendChild(btn);
});

ol.control.Control.call(this, {
    element: this.element,
    target: opt_options.target
})
```

é€šè¿‡`addInteraction`å®ç°äº¤äº’çš„ç»˜å›¾å‘½ä»¤åˆ‡æ¢åŠŸèƒ½ã€‚

```javascript
ol.control.DrawControl.prototype.addInteraction = function(shapeType){
    this.initSource();
    if(shapeType !== 'None'){
        var geomFunc = undefined;
        if(shapeType === 'Clear'){
            this.source_.clear();
            return;
        }
        if(shapeType === 'Box') {
            shapeType = 'Circle';
            geomFunc = ol.interaction.Draw.createBox();
        }
        this.drawing_ = new ol.interaction.Draw({
            source: this.source_,
            type: shapeType,
            freehand: false,    //æŒ‰ä½shiftå¯ä»¥è·Ÿè¸ªé¼ æ ‡ç»˜åˆ¶
            geometryFunction: geomFunc
        });
        this.getMap().addInteraction(this.drawing_);
    }
}
```

ï¼ˆ3ï¼‰æŒ‰é’®æ ·å¼

â€‹	æ–°å»ºä¸€ä¸ª`css`æ–‡ä»¶æ¥è®¾å®šæŒ‰é’®çš„æ ·å¼ã€‚
â€‹	é¦–å…ˆè§„å®šå·¥å…·æ¡çš„ä½ç½®ä»¥åŠæ ¼å¼ï¼Œä»¤æŒ‰é’®çºµå‘æ’åˆ—ã€‚

```css
.drawtools{
    top: 5em;
    right: 1em;
    flex-direction:column;
}
```

ç„¶åä¸ºæ¯ä¸ªæŒ‰é’®æ’å…¥å›¾ç‰‡ä½œä¸ºæ ‡è¯†ã€‚

```css
#ol-draw-none{
    background: url(./img/pointer_16px.png) no-repeat;
}
#ol-draw-point{
    background: url(./img/point_16px.png) no-repeat;
}
#ol-draw-linestring{
    background: url(./img/linestring_16px.png) no-repeat;
}
#ol-draw-polygon{
    background: url(./img/polygon_16px.png) no-repeat;
}
#ol-draw-circle{
    background: url(./img/circle_16px.png) no-repeat;
}
#ol-draw-box{
    background: url(./img/box_16px.png) no-repeat;
}
#ol-draw-clear{
    background: url(./img/clear.png) no-repeat;
}
```

åœ¨åŠ è½½ç“¦ç‰‡åœ°å›¾æ—¶ï¼Œåœ¨é»˜è®¤æ§ä»¶çš„åŸºç¡€ä¸Šï¼Œå†åŠ ä¸Šå…¶ä»–å†…ç½®çš„æ§ä»¶ï¼Œå³`MousePosition()`ï¼ˆé¼ æ ‡ä½ç½®æ§ä»¶ï¼‰ã€`FullScreen()`ï¼ˆå…¨å±æŸ¥çœ‹æ§ä»¶ï¼‰å’Œ`ScaleLine()`ï¼ˆæ¯”ä¾‹å°ºæ§ä»¶ï¼‰ã€‚

```javascript
    var map = new ol.Map({
        target: 'map',
        controls: ol.control.defaults().extend([
            new ol.control.MousePosition(),
            new ol.control.FullScreen(),
            new ol.control.ScaleLine()
        ]),
```

æœ€ååœ¨`html`çš„`body`ä¸­æ·»åŠ å¼•ç”¨ä¸¤ä¸ª`js`æ–‡ä»¶ï¼Œå®ç°4ç§åœ°å›¾æ§ä»¶ï¼Œæ•ˆæœå¦‚ä¸‹ã€‚

![image-20230428092536257](README.assets/image-20230428092536257.png)

åŠ¨ç”»æ•ˆæœçš„ä¸»è¦å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š

ï¼ˆ1ï¼‰æ–°å»ºä¸€ä¸ª`html`é¡µé¢ï¼ŒåŠ è½½å¤©åœ°å›¾ç“¦ç‰‡å›¾å±‚ï¼›

ï¼ˆ2ï¼‰åœ¨åœ°å›¾å®¹å™¨divå±‚ä¸­åˆ†åˆ«æ–°å»ºå››ä¸ªæŒ‰é’®ï¼Œå¹¶è®¾ç½®æŒ‰é’®çš„`ID`å€¼ï¼›

ï¼ˆ3ï¼‰ä¸ºè¿™äº›æŒ‰é’®æ·»åŠ ç›¸åº”çš„å•æœºå‡½æ•°ï¼Œåˆ†åˆ«å®ç°å„ç§åŠ¨ç”»æ•ˆæœçš„å®šä½åŠŸèƒ½ã€‚åœ¨å‡½æ•°ä¸­å…ˆå®ä¾‹åŒ–åŠ¨ç”»åŠŸèƒ½ç±»ï¼Œç„¶åé€šè¿‡`ol.View`ç±»çš„`animate`æ–¹æ³•è®¾ç½®åŠ¨ç”»æ•ˆæœã€‚æˆ‘åˆ†åˆ«é€šè¿‡æ—‹è½¬ã€å¼¹æ€§ã€åå¼¹ã€è‡ªæ—‹å®šä½åˆ°äº†å°å­¦ã€åˆä¸­ã€é«˜ä¸­ã€å¤§å­¦ã€‚å®ç°ç•Œé¢å¦‚ä¸‹ï¼š

![image-20230428092607228](README.assets/image-20230428092607228.png)

åœ¨å®ä¹ ä¸€ä¸­åˆ¶ä½œçš„ä¸ªäººä»‹ç»é¡µé¢ä¸­ï¼Œé€šè¿‡`<a>`æ·»åŠ é¡µé¢çš„ç‚¹å‡»è·³è½¬ï¼ŒæŸ¥çœ‹æ•™è‚²ç»å†ã€‚

![image-20230428092630725](README.assets/image-20230428092630725.png)

##  æ€»ç»“

